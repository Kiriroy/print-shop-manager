<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrintShop Pro Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Custom scrollbar for cleaner look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .sidebar-active { background-color: #e2e8f0; border-right: 4px solid #3b82f6; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 font-sans antialiased">

    <div class="flex h-screen overflow-hidden">
        
        <aside class="w-64 bg-white shadow-md hidden md:flex flex-col z-10">
            <div class="p-6 text-center border-b">
                <h1 class="text-2xl font-bold text-blue-600"><i class="fa-solid fa-print mr-2"></i>PrintShop</h1>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <button onclick="showSection('dashboard')" id="nav-dashboard" class="w-full text-left px-4 py-3 rounded hover:bg-gray-100 sidebar-active transition">
                    <i class="fa-solid fa-chart-line w-6"></i> Dashboard
                </button>
                <button onclick="showSection('orders')" id="nav-orders" class="w-full text-left px-4 py-3 rounded hover:bg-gray-100 transition">
                    <i class="fa-solid fa-file-invoice w-6"></i> Print Orders
                </button>
                <button onclick="showSection('expenses')" id="nav-expenses" class="w-full text-left px-4 py-3 rounded hover:bg-gray-100 transition">
                    <i class="fa-solid fa-wallet w-6"></i> Expenses
                </button>
                <button onclick="showSection('customers')" id="nav-customers" class="w-full text-left px-4 py-3 rounded hover:bg-gray-100 transition">
                    <i class="fa-solid fa-users w-6"></i> Customers
                </button>
            </nav>
            <div class="p-4 border-t">
                <button onclick="exportData()" class="w-full bg-slate-700 text-white py-2 rounded hover:bg-slate-800 transition">
                    <i class="fa-solid fa-download mr-2"></i> Backup Data
                </button>
            </div>
        </aside>

        <div class="flex-1 flex flex-col h-screen overflow-y-auto">
            <header class="md:hidden bg-white p-4 shadow flex justify-between items-center">
                <span class="font-bold text-lg text-blue-600">PrintShop</span>
                <button class="text-gray-600"><i class="fa-solid fa-bars text-xl"></i></button>
            </header>

            <main class="p-6 md:p-10">
                
                <div id="dashboard" class="section">
                    <h2 class="text-3xl font-bold mb-6">Dashboard Overview</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-green-500">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Total Sales</p>
                                    <h3 class="text-2xl font-bold" id="dash-sales">$0.00</h3>
                                </div>
                                <div class="bg-green-100 p-3 rounded-full text-green-600"><i class="fa-solid fa-dollar-sign"></i></div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-red-500">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Total Expenses</p>
                                    <h3 class="text-2xl font-bold" id="dash-expenses">$0.00</h3>
                                </div>
                                <div class="bg-red-100 p-3 rounded-full text-red-600"><i class="fa-solid fa-arrow-trend-down"></i></div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-blue-500">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Net Profit</p>
                                    <h3 class="text-2xl font-bold" id="dash-profit">$0.00</h3>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full text-blue-600"><i class="fa-solid fa-piggy-bank"></i></div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h4 class="font-semibold mb-4 text-gray-700">Financial Overview</h4>
                            <canvas id="financeChart"></canvas>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h4 class="font-semibold mb-4 text-gray-700">Recent Activity</h4>
                            <ul id="recent-activity-list" class="space-y-3 text-sm text-gray-600">
                                </ul>
                        </div>
                    </div>
                </div>

                <div id="orders" class="section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold">Print Orders</h2>
                        <button onclick="toggleModal('orderModal')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            <i class="fa-solid fa-plus mr-1"></i> New Order
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
                                <tr>
                                    <th class="p-4">Date</th>
                                    <th class="p-4">Customer</th>
                                    <th class="p-4">Job Type</th>
                                    <th class="p-4">Status</th>
                                    <th class="p-4 text-right">Amount</th>
                                    <th class="p-4 text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body" class="text-sm">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div id="expenses" class="section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold">Expenses</h2>
                        <button onclick="toggleModal('expenseModal')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                            <i class="fa-solid fa-plus mr-1"></i> Add Expense
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
                                <tr>
                                    <th class="p-4">Date</th>
                                    <th class="p-4">Category</th>
                                    <th class="p-4">Description</th>
                                    <th class="p-4 text-right">Cost</th>
                                    <th class="p-4 text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody id="expenses-table-body" class="text-sm">
                                </tbody>
                        </table>
                    </div>
                </div>

                 <div id="customers" class="section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold">Customer Directory</h2>
                        </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="customer-grid">
                        </div>
                </div>

            </main>
        </div>
    </div>

    <div id="orderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg w-full max-w-md p-6">
            <h3 class="text-xl font-bold mb-4">Add New Print Job</h3>
            <form id="orderForm" onsubmit="handleOrderSubmit(event)">
                <input type="date" id="orderDate" required class="w-full border p-2 rounded mb-3 bg-gray-50">
                <input type="text" id="orderCustomer" placeholder="Customer Name" required class="w-full border p-2 rounded mb-3">
                <select id="orderType" class="w-full border p-2 rounded mb-3">
                    <option value="Document Print">Document Print (Plain)</option>
                    <option value="Photo Print">Photo Print</option>
                    <option value="Tarpaulin">Tarpaulin</option>
                    <option value="ID Photo">ID Photo</option>
                    <option value="Xerox/Copy">Xerox/Copy</option>
                </select>
                <div class="flex gap-2 mb-3">
                    <input type="number" id="orderQty" placeholder="Qty" required class="w-1/3 border p-2 rounded">
                    <input type="number" step="0.01" id="orderPrice" placeholder="Total Price" required class="w-2/3 border p-2 rounded">
                </div>
                <select id="orderStatus" class="w-full border p-2 rounded mb-4">
                    <option value="Pending">Pending</option>
                    <option value="Done">Done</option>
                    <option value="Claimed">Claimed</option>
                </select>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="toggleModal('orderModal')" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save Order</button>
                </div>
            </form>
        </div>
    </div>

    <div id="expenseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg w-full max-w-md p-6">
            <h3 class="text-xl font-bold mb-4">Add Expense</h3>
            <form id="expenseForm" onsubmit="handleExpenseSubmit(event)">
                <input type="date" id="expDate" required class="w-full border p-2 rounded mb-3 bg-gray-50">
                <select id="expCategory" class="w-full border p-2 rounded mb-3">
                    <option value="Materials">Materials (Ink/Paper)</option>
                    <option value="Utilities">Utilities (Electricity/Net)</option>
                    <option value="Rent">Rent</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Other">Other</option>
                </select>
                <input type="text" id="expDesc" placeholder="Description / Notes" class="w-full border p-2 rounded mb-3">
                <input type="number" step="0.01" id="expAmount" placeholder="Amount" required class="w-full border p-2 rounded mb-4">
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="toggleModal('expenseModal')" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Save Expense</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // State Management
        let appData = {
            orders: [],
            expenses: []
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            // Set default dates to today
            document.getElementById('orderDate').valueAsDate = new Date();
            document.getElementById('expDate').valueAsDate = new Date();
            updateUI();
        });

        // Navigation Logic
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Sidebar active state
            document.querySelectorAll('aside nav button').forEach(btn => btn.classList.remove('sidebar-active'));
            document.getElementById('nav-' + sectionId).classList.add('sidebar-active');
        }

        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.toggle('hidden');
        }

        // Data Handling
        function saveData() {
            localStorage.setItem('printShopData', JSON.stringify(appData));
            updateUI();
        }

        function loadData() {
            const stored = localStorage.getItem('printShopData');
            if (stored) {
                appData = JSON.parse(stored);
            } else {
                // Dummy Data for first run
                appData.orders = [
                    { id: 1, date: '2023-10-25', customer: 'John Doe', type: 'Tarpaulin', qty: 2, price: 500, status: 'Claimed' },
                    { id: 2, date: '2023-10-26', customer: 'Jane Smith', type: 'Photo Print', qty: 10, price: 150, status: 'Pending' }
                ];
                appData.expenses = [
                    { id: 1, date: '2023-10-24', category: 'Materials', desc: 'Bond Paper 5 Reams', amount: 1200 }
                ];
                saveData();
            }
        }

        // CRUD Operations
        function handleOrderSubmit(e) {
            e.preventDefault();
            const newOrder = {
                id: Date.now(),
                date: document.getElementById('orderDate').value,
                customer: document.getElementById('orderCustomer').value,
                type: document.getElementById('orderType').value,
                qty: document.getElementById('orderQty').value,
                price: parseFloat(document.getElementById('orderPrice').value),
                status: document.getElementById('orderStatus').value
            };
            appData.orders.unshift(newOrder); // Add to top
            toggleModal('orderModal');
            e.target.reset();
            saveData();
        }

        function handleExpenseSubmit(e) {
            e.preventDefault();
            const newExp = {
                id: Date.now(),
                date: document.getElementById('expDate').value,
                category: document.getElementById('expCategory').value,
                desc: document.getElementById('expDesc').value,
                amount: parseFloat(document.getElementById('expAmount').value)
            };
            appData.expenses.unshift(newExp);
            toggleModal('expenseModal');
            e.target.reset();
            saveData();
        }

        function deleteItem(type, id) {
            if(confirm('Are you sure you want to delete this record?')) {
                if(type === 'order') {
                    appData.orders = appData.orders.filter(i => i.id !== id);
                } else {
                    appData.expenses = appData.expenses.filter(i => i.id !== id);
                }
                saveData();
            }
        }

        function updateStatus(id) {
            const order = appData.orders.find(o => o.id === id);
            if (order.status === 'Pending') order.status = 'Done';
            else if (order.status === 'Done') order.status = 'Claimed';
            else if (order.status === 'Claimed') order.status = 'Pending';
            saveData();
        }

        // UI Rendering
        function updateUI() {
            renderDashboard();
            renderOrders();
            renderExpenses();
            renderCustomers();
        }

        function renderOrders() {
            const tbody = document.getElementById('orders-table-body');
            tbody.innerHTML = '';
            appData.orders.forEach(order => {
                let statusColor = order.status === 'Claimed' ? 'bg-green-100 text-green-700' : 
                                  order.status === 'Done' ? 'bg-blue-100 text-blue-700' : 'bg-yellow-100 text-yellow-700';
                
                tbody.innerHTML += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-4">${order.date}</td>
                        <td class="p-4 font-medium">${order.customer}</td>
                        <td class="p-4"><span class="bg-gray-100 px-2 py-1 rounded text-xs">${order.type}</span> (${order.qty})</td>
                        <td class="p-4"><span onclick="updateStatus(${order.id})" class="cursor-pointer ${statusColor} px-2 py-1 rounded-full text-xs font-bold">${order.status}</span></td>
                        <td class="p-4 text-right font-bold">$${order.price.toFixed(2)}</td>
                        <td class="p-4 text-center">
                            <button onclick="deleteItem('order', ${order.id})" class="text-red-500 hover:text-red-700"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderExpenses() {
            const tbody = document.getElementById('expenses-table-body');
            tbody.innerHTML = '';
            appData.expenses.forEach(exp => {
                tbody.innerHTML += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-4">${exp.date}</td>
                        <td class="p-4"><span class="bg-gray-100 px-2 py-1 rounded text-xs">${exp.category}</span></td>
                        <td class="p-4 text-gray-600">${exp.desc}</td>
                        <td class="p-4 text-right font-bold text-red-600">-$${exp.amount.toFixed(2)}</td>
                        <td class="p-4 text-center">
                            <button onclick="deleteItem('expense', ${exp.id})" class="text-red-500 hover:text-red-700"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderCustomers() {
            const grid = document.getElementById('customer-grid');
            // Extract unique customers
            const customers = [...new Set(appData.orders.map(o => o.customer))];
            grid.innerHTML = '';
            customers.forEach(cust => {
                const totalSpend = appData.orders.filter(o => o.customer === cust).reduce((sum, o) => sum + o.price, 0);
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded shadow-sm flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-lg">${cust}</h4>
                            <p class="text-xs text-gray-500">Total Orders: ${appData.orders.filter(o => o.customer === cust).length}</p>
                        </div>
                        <div class="text-right">
                            <span class="block text-sm font-bold text-green-600">$${totalSpend.toFixed(2)}</span>
                            <span class="text-xs text-gray-400">Lifetime Value</span>
                        </div>
                    </div>
                `;
            });
        }

        function renderDashboard() {
            // Calculations
            const totalSales = appData.orders.reduce((sum, item) => sum + item.price, 0);
            const totalExp = appData.expenses.reduce((sum, item) => sum + item.amount, 0);
            const profit = totalSales - totalExp;

            document.getElementById('dash-sales').innerText = `$${totalSales.toFixed(2)}`;
            document.getElementById('dash-expenses').innerText = `$${totalExp.toFixed(2)}`;
            document.getElementById('dash-profit').innerText = `$${profit.toFixed(2)}`;
            
            // Recent Activity
            const list = document.getElementById('recent-activity-list');
            list.innerHTML = '';
            appData.orders.slice(0, 5).forEach(o => {
                list.innerHTML += `<li class="flex justify-between border-b pb-2"><span>${o.customer} ordered ${o.type}</span> <span class="font-bold text-green-600">+$${o.price}</span></li>`;
            });

            // Update Chart
            updateChart(totalSales, totalExp);
        }

        // Chart.js Configuration
        let myChart;
        function updateChart(sales, expenses) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if (myChart) myChart.destroy();
            
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Sales', 'Expenses', 'Profit'],
                    datasets: [{
                        data: [sales, expenses, sales - expenses],
                        backgroundColor: ['#4ade80', '#f87171', '#60a5fa'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, cutout: '70%' }
            });
        }

        // Export Function
        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appData));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "printshop_backup_" + new Date().toISOString().slice(0,10) + ".json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }
    </script>
</body>
</html>